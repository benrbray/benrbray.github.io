---
import { getPostUrl, postIsPublished } from '@root/util/query';
import type { CollectionEntry } from 'astro:content';
import FormattedDate from '../dates/FormattedDate.astro';
import PostTags from './PostTags.astro';
interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const postUrl = getPostUrl(post);
const postDisplayTitle = post.data.titleDisplay || post.data.title;
const isLowPriority = post.data.priority === "low";
const isProject = post.data.kind === "project";
---


<div class:list={[
  "post-summary-box",
  `priority-${post.data.priority}`,
  `kind-${post.data.kind === "project" ? "project" : "post"}`,
]}>
  <!-- summary -->
  <div class="post-desc">
    <!-- title -->
    <div class="post-title">
      <a href={postUrl}
         class:list={[{ unpublished: !postIsPublished(post) }]}
         set:html={postDisplayTitle}
      />
    </div>
    <div class="post-subtitle">
      <span class="post-year"><FormattedDate date={post.data.datePublished} /></span>
      <PostTags tags={post.data.tags || []} tools={post.data.tools || []} />
    </div>
    {!isLowPriority && isProject && <div class="post-summary" set:html={post.data.summary} />}
  </div>
  <!-- thumbnail -->
  {
    !isLowPriority && post.data.imageThumbnail &&
    (<div class="post-thumb">
      <img alt="" src={post.data.imageThumbnail} />
    </div>)
  }
</div>

<style>
.post-summary-box {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 1.0rem;

  width: 100%;
  margin: 1.0rem 0;
}

@media (max-width: 52rem) {
  .post-summary-box {
    flex-direction: column;
  }
}

.post-summary-box.kind-project {
  background-color: #ddf7ff;
  padding: var(--gap-1);
}

.post-summary-box.kind-post {
  padding: 0 var(--gap-1);
}

.post-summary-box .post-desc {
  flex: 1;
}

.post-summary-box .post-thumb {
  flex-basis: 40%;
  max-height: 8em;

  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.post-summary-box .post-thumb img {
  display: block;
  min-width: 100%;
}

.post-summary-box .post-title {
  /* display: flex; */
  justify-content: space-between;

  margin-bottom: var(--gap-0);
  font-size: var(--font-size-large);
  font-weight: var(--font-title-weight);
}

.post-summary-box .post-subtitle,
.post-summary-box .post-subtitle {
  margin: var(--gap-0) 0;
  text-overflow: hidden;
  overflow: hidden;
}

.post-summary-box .post-summary p:first-child,
.post-summary-box .post-summary p:first-child {
  margin-top: 0;
}

.post-summary-box .post-year,
.post-summary-box .post-year {
  color: gray;
  white-space: nowrap;
}

.post-summary-box .post-title a { color: unset; }
</style>